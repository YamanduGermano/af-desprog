<!DOCTYPE html>
<html lang="pt-br">

<head>
    <title>Algoritmo de Fortune para Diagrama de Voronoi</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,700;1,400;1,700&family=Open+Sans+Condensed:ital,wght@0,300;1,300&family=Open+Sans:ital,wght@0,300;0,400;0,700;0,800;1,300;1,400;1,700;1,800&family=Oxygen+Mono&family=Josefin+Sans:ital,wght@0,200;0,600;1,200;1,600&display=swap">
    <link rel="stylesheet" href="assets/css/reset.css">
    <link rel="stylesheet" href="assets/css/highlight.css">
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/css/color.css">
    <!--<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>-->
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script async src="https://static.codepen.io/assets/embed/ei.js"></script>
    <script src="assets/js/highlight.js"></script>
    <script src="assets/js/script.js"></script>
</head>

<body>
    <div class="container">
        <header>
            <a href="">abrir tudo</a>
            <a href="">fechar tudo</a>
        </header>
        <main>

            <h1>Algoritmo de Fortune para Diagrama de Voronoi</h1>
<h2>Como se encontrar pela cidade</h2>
<h2>Motivação</h2>
<!-- Imagine que você é um pássaro!
Você está voando o dia todo e não conseguiu beber nenhum gole de água. Por sorte, você sabe que ao seu redor, num raio de poucos quilômetros, existem algumas fontes de água. Aqui está o mapa da floresta: -->
<p>Imagine uma atividade rotineira como fazer uma <strong>ligação de vídeo</strong> para uma pessoa muito especial (para merecer uma ligação de vídeo, precisa ser especial mesmo). Nesse contexto, uma prioridade é enviar e receber informações com a <strong>menor latência</strong> possível.</p>
<p>Ao seu redor, existem várias antenas de comunicação para as quais podemos mandar um sinal. Esse sinal vai ser retransmitido por vários pontos ao longo da infraestrutura global de comunicação até chegar no seu destino. A fim de <em>minimizar a latência</em> e aumentar a chance do sinal ser recebido sem perdas, seu celular enviar o sinal para a <strong>antena mais próxima</strong>.</p>
<p>Seu celular sabe sua posição no mapa e a posição das antenas ao seu redor:</p>
<figure class="img"><img src="img/mapa1.jpg" alt="Mapa da cidade"></figure>
<blockquote class="warning">
<p>Aviso</p>
<p>Como é descobrimos qual a antena mais próxima de você?</p>
</blockquote>
<h2>Método das distâncias:</h2>
<figure class="img"><img src="img/mapa2.jpg" alt="Mapa da cidade com coordenadas"></figure>
<p>É possível calcular todas as distâncias entre os você e cada um dos pontos utilizando o teorema de pitágoras.</p>
<p>O arquivo <code class="language-md">dist_m1.py</code> calcula todas essas distâncias e imprime seus valores:</p>
<figure class="table"><table>
<thead>
<tr>
<th>Lugar</th>
<th>Distância</th>
</tr>
</thead>
<tbody>
<tr>
<td>Queda d’água</td>
<td>1.12 km</td>
</tr>
<tr>
<td>Riacho</td>
<td>2.92 km</td>
</tr>
<tr>
<td>Pedra do sapo</td>
<td>1.80 km</td>
</tr>
<tr>
<td>Córrego azul</td>
<td>2.24 km</td>
</tr>
<tr>
<td>Rio Branco</td>
<td>2.24 km</td>
</tr>
<tr>
<td>Pedra molhada</td>
<td>2.12 km</td>
</tr>
<tr>
<td>Lagoa doce</td>
<td>2.55 km</td>
</tr>
</tbody>
</table></figure>
<p>A antena mais próxima seria a <strong>Queda d’água</strong> com <strong>1.12km</strong> de distância</p>
<p>É notável que essa tarefa não é muito eficiente. E, se saíssemos da mesma posição, precisaríamos calcular todas as distâncias novamente.</p>
<p>E se existisse um mapa que indique, para qualquer posição, qual a antena mais próxima?</p>
<h2>Subdivisão por células</h2>
<p>Vamos começar por um exemplo simples. Temos apenas duas antenas no nosso mapa:</p>
<figure class="img"><img src="img/mapa3.jpg" alt="Duas antenas no mapa"></figure>
<p>Como podemos dividir esse espaço de modo a indicar, para qualquer ponto no mapa, qual a antena mais próxima?</p>
<blockquote class="question">
<p>Pergunta</p>
<p>Pegue um papel e uma caneta e tente desenhar esse diagrama!</p>
<details class="answer">
<summary>Resposta</summary>
<p>Vamos traçar uma aresta que passa entre ambas as fontes e pintar de azul todos os pontos em que estão à esquerda dela e de verde aqueles que estão a sua direita:</p>
<figure class="img"><img src="img/mapa4.jpg" alt="Subdivisão do mapa em duas células"></figure>
<p>Agora, sabemos que, se você estiver em qualquer ponto azul, o ponto mais próximo é a <code class="language-md">Antena A</code>. Se você estiver em qualquer ponto verde, porém, o ponto mais próximo é a <code class="language-md">Antena B</code>.</p>
</details>
</blockquote>
<p>Esse princípio</p>
<p>Agora vamos tentar com três pontos:</p>
<figure class="img"><img src="img/mapa5.jpg" alt="Três antenas no mapa"></figure>
<blockquote class="question">
<p>Pergunta</p>
<p>Pegue um papel e uma caneta e tente desenhar esse diagrama!</p>
<details class="answer">
<summary>Resposta</summary>
<p>Se traçarmos uma reta que divide cada um das antenas entre si, podemos criar três arestas que subdividem o espaço em três células distintas.</p>
<figure class="img"><img src="img/mapa6.jpg" alt="Três células no mapa"></figure>
<!-- Se ligarmos uma reta ligando dois pontos quaisquer e traçarmos outra reta perpendicular a ela que cruza o seu centro, conseguimos subdividir o espaço com três arestas. -->
<p><strong>Observe atentamente esse diagrama e preste atenção nos detalhes:</strong></p>
<ul>
<li>
<p>O cruzamento de todos os segmentos de reta é no <strong>baricentro</strong> do triangulo formado pelas ligações entre os pontos.</p>
</li>
<li>
<p>O ângulo entre cada uma das arestas e as retas que ligam 2 pontos é de 90º.</p>
</li>
<li>
<p>Uma aresta sempre <strong>divide ao meio</strong> uma reta que liga dois pontos.</p>
</li>
</ul>
<p>Assim, é muito mais fácil ver qual o ponto d’água mais próximo para qualquer ponto do mapa!</p>
</details>
</blockquote>
<h2>Diagrama de Voronoi:</h2>
<p>Dividindo pontos com arestas dessa maneira, podemos criar um mapa que nos conta exatamente qual o ponto mais próximo! Esse é o princípio do <strong>Diagrama de Voronoi</strong>.</p>
<figure class="img"><img src="img/Coloured_Voronoi_2D.png" alt="Diagrama de Voronoi"></figure>
<p>Source: <a href="https://pt.wikipedia.org/wiki/Diagrama_de_Voronoy" target="_blank">Wikipédia</a></p>
<h2>O algoritmo de Fortune</h2>
<p>Uma das formas mais eficientes de gerar diagramas de Voronoi é com o algoritmo de Fortune. Para entender seu funcionamento, vamos partir de uma ideia diferente — mas calma, no fim tudo fará sentido.</p>
<p>Vamos começar com o exemplo abaixo:</p>
<blockquote class="question">
<p>Pergunta</p>
<p>Pegue um papel e caneta e desenhe um ponto pequeno (chamaremos de ponto1), com uma linha horizontal poucos centimetros abaixo e desenhe 5 pontos sobre essa linha (Facilita se você colocar o ponto do meio exatamente embaixo do ponto1). Agora tente encontrar os pontos de equidistancia entre o ponto original e os pontos sobre a linha.</p>
<p>Vai ficar algo parecido com isso:</p>
<figure class="img"><img src="img/mapa7.jpg" alt="Ponto e Pontos na linha"></figure>
<p>Agora, tente encontrar os pontos equidistantes entre os pontos da linha e o ponto 1</p>
<details class="answer">
<summary>Resposta</summary>
<p>Seu diagrama deve ficar algo parecido com:</p>
<figure class="img"><img src="img/mapa8.jpg" alt="Pontos de equidistancia"></figure>
</details>
</blockquote>
<blockquote class="question">
<p>Pergunta</p>
<p>Você consegue perceber alguma relação entre esses pontos? Que formato esse padrão formaria?</p>
<details class="answer">
<summary>Resposta</summary>
<p>Você deve ter concluido que os pontos de equidistancia formam uma parabola</p>
<figure class="img"><img src="img/mapa9.jpg" alt="Parabola"></figure>
</details>
</blockquote>
<p>Agora partimos para um segundo instante. Vamos imaginar que a sweeping line desceu um pouco, para um pouco mais longe do nosso ponto 1.</p>
<blockquote class="question">
<p>Pergunta</p>
<p>Tente pensar no que vai acontecer com os pontos e então com a parabola.</p>
<p>Será que ela vai abrir/fechar mais? Será que vai permanecer igual?</p>
<p>Se não estiver conseguindo visualizar, use o papel e compare as respostas. Para que a diferença fique mais clara, faca uma sweeping line bem mais longe do ponto.</p>
<details class="answer">
<summary>Resposta</summary>
<p>A parabola vai abrir cada vez mais quando a sweeping line desce.</p>
<figure class="img"><img src="img/mapa10.jpg" alt="Parabola aberta"></figure>
</details>
</blockquote>
<p>Caso tenha restado alguma duvida, desenvolvemos um <a href="https://www.geogebra.org/calculator/xztbxdvv?" target="_blank">arquivo no Geogebra</a> que facilita muito o entendimento:</p>
<div style="position:relative; width:fit">
<!-- <iframe src="https://www.geogebra.org/calculator/xztbxdvv?embed" allowfullscreen style="border: 1px solid #e4e4e4;border-radius: 4px; width:100%; height:70vh" frameborder="0"></iframe> -->
</div>
<p>Agora que nós deduzimos o comportamento do gráfico para um ponto so, está na hora de acrescentar um segundo ponto.</p>
<hr>
<p>Agora com dois pontos, desenharemos sua parábola para cada um deles seguindo o mesmo procedimento da etapa anterior. Nosso foco cairá sobre a interseção entre essas parabolas:</p>
<figure class="img"><img src="img/mapa11.jpg" alt="Duas parábolas"></figure>
<blockquote class="question">
<p>Pergunta</p>
<p>Antes de continuar, tente refletir sobre o que esse ponto de interseção significa. Utilizando o conhecimento de como os pontos da parábola são formados.</p>
<details class="answer">
<summary>Resposta</summary>
<figure class="img"><img src="img/mapa12.jpg" alt="Pontos equidistantes"></figure>
</details>
</blockquote>
<blockquote class="question">
<p>Pergunta</p>
<p>Sabendo disso, imagine a sweeping line descendo em relação a sua posição anterior. Imagine o que pode estar acontecendo com os pontos de interseção.</p>
<p>Desenvolvemos um <a href="https://www.geogebra.org/calculator/vkarzdzv" target="_blank">arquivo do Geogebra</a> que vai ajudar bastante a tirar essa conclusão. Tente encontrar o tipo de relação entre os pontos de interseção com variação da sweeping line.</p>
<blockquote class="warning">
<p>Dica:</p>
<p>Para obter a resposta, ativar o trace do ponto de interseção.</p>
<p>Você deve ter concluido que os pontos tem uma relação linear uns com os outros. Essa linha que está sendo formada é justamente uma das arestas do diagrama de Voronoi.</p>
<p>Então, conforme a sweeping line desce, o algoritmo está traçando a aresta que divide os dois pontos no diagrama</p>
</blockquote>
</blockquote>
<blockquote class="question">
<p>Pergunta</p>
<p>Então, sabendo isso e do que falamos anteriormente sobre o diagrama de Voronoi, o que conseguimos concluir sobre pontos quaisquer que estão em um dos lados da linha? O que todos tem em comum com os seus respectivos pontos de interesse?</p>
<blockquote class="warning">
<p>Dica:</p>
<p>Pense na distancia</p>
</blockquote>
<details class="answer">
<summary>Resposta</summary>
<p>Conseguimos concluir que um ponto qualquer de um dos lados da linha está mais próximo do ponto de interesse que está do mesmo lado do que do outro ponto de interesse.</p>
</details>
</blockquote>
<p>Parabens, você acabou de entender a lógica por trás de um algoritmo de Fortune para 2 pontos em um grafico!</p>
<hr>
<p>Antes de adicionarmos um ponto, vamos entender o conceito da beachline.</p>
<p>Como no início do handout, pense nos pontos equidistantes entre um ponto e a sweeping line — eles formam uma parábola. Pensou? Agora imagine duas dessas parábolas. A beachline é formada pelos pontos que estão ao mesmo tempo nas duas parábolas e que estão mais próximos da sweeping line em cada posição no eixo x.</p>
<p>Aqui esta uma imagem que nos ajuda a visualizar isso.</p>
<figure class="img"><img src="img/mapa13.jpg" alt="Beachline com 4 pontos"></figure>
<p>Agora que entendemos o conceito, vamos adicionar um terceiro ponto. A lógica é a mesma para 4, 5 ou mais pontos, então, ao compreendermos o caso com 3, poderemos generalizar para qualquer quantidade.</p>
<figure class="img"><img src="img/mapa14.jpg" alt="Beachline com 4 pontos"></figure>
<p>Criamos um <a href="https://www.geogebra.org/calculator/nghuzruv" target="_blank">arquivo do Geogebra</a> que facilita essa visualização e entendimento.</p>
<hr>
<h2>Três Pontos</h2>
<p>Agora que você já entendeu a lógica para um ponto e para dois pontos, chegou a hora de adicionar o terceiro.</p>
<p>Prepare o papel e a caneta: desenhe três pontos não alinhados — algo como um triângulo.
A sweeping line (linha de varredura) começa acima desses pontos e começa a descer lentamente.</p>
<p>Cada ponto vai gerar sua própria parábola, exatamente como vimos antes.</p>
<blockquote class="question">
<p>Pergunta</p>
<p>Desenhe as três parábolas com a sweeping line passando logo abaixo dos pontos.
O que você percebe?</p>
<details class="answer">
<summary>Resposta</summary>
<figure class="img"><img src="img/beachline_3pts.png" alt="Beachline 3 pontos"></figure>
<p>Perceba que cada ponto (P₁, P₂ e P₃) gera uma parábola diferente — cada uma representa todos os lugares que estão à mesma distância entre aquele ponto e a sweeping line.
A linha roxa na base, chamada beachline, é formada pelos trechos mais baixos dessas parábolas, isto é, os pontos mais próximos da sweeping line em cada posição no eixo x.</p>
<p>Os pontos A e B são as interseções entre as parábolas — eles marcam os limites entre as regiões de influência dos pontos.</p>
<p>Esses pontos de interseção são o primeiro indício das arestas do Diagrama de Voronoi:
eles mostram onde a influência de um ponto termina e a de outro começa.</p>
</details>
</blockquote>
<hr>
<h2>O Segredo das Interseções</h2>
<p>Vamos observar com mais atenção os pontos A e B.
Eles aparecem exatamente onde as parábolas se cruzam — onde a influência de um ponto começa a dar lugar à de outro.</p>
<p>Esses cruzamentos não são apenas coincidências gráficas; eles têm um significado geométrico profundo.
Para entender o que realmente está acontecendo nesses pontos, precisamos olhar para o que eles representam em termos de distância.</p>
<blockquote class="question">
<p>Pergunta</p>
<p>Se um ponto está na interseção de duas parábolas, o que isso significa sobre as distâncias?</p>
<details class="answer">
<summary>Resposta</summary>
<figure class="img"><img src="img/circunferencia_1.png" alt="Equidistancia de 2 Pontos"></figure>
<p>Esse ponto está equidistante de três elementos:</p>
<ul>
<li>do Ponto 1,</li>
<li>do Ponto 2,</li>
<li>da sweeping line.</li>
</ul>
</details>
</blockquote>
<p>Agora imagine que a sweeping line continua descendo lentamente de ponto a ponto.
Cada vez que ela se move, as parábolas mudam de forma e os pontos de interseção (como A e B) também se deslocam.</p>
<p>Mas há um instante muito especial: o momento em que as três parábolas se encontram em um único ponto.</p>
<blockquote class="question">
<p>Pergunta</p>
<p>O que isso significa?</p>
<details class="answer">
<summary>Resposta</summary>
<figure class="img"><img src="img/circunferencia_2.png" alt="Equidistancia de 3 Pontos"></figure>
<p>Nesse exato ponto, estamos à mesma distância de:</p>
<ul>
<li>Ponto 1</li>
<li>Ponto 2</li>
<li>Ponto 3</li>
<li>e da sweeping line</li>
</ul>
<p>É como se o espaço “entrasse em equilíbrio” entre os três pontos — nenhum deles é mais próximo que o outro.</p>
</details>
</blockquote>
<hr>
<h2>A “Parábola Engolida”</h2>
<p>Você já viu que, em um instante específico, as três parábolas se encontram em um mesmo ponto —
aquele ponto que está à mesma distância dos três focos e da sweeping line.</p>
<p>Nesse momento, algo marcante acontece:
a parábola do ponto mais alto desaparece da beachline — ela é “engolida” pelas outras duas.</p>
<blockquote class="question">
<p>Pergunta</p>
<p>O que isso significa sobre as distâncias?</p>
<details class="answer">
<summary>Resposta</summary>
<p>Esse ponto está à mesma distância dos três focos e da sweeping line.
Se registrássemos todos os pontos que mantêm essa distância constante, formaríamos um contorno fechado.</p>
<p>Pense: qual é a forma geométrica que reúne todos os pontos que estão à mesma distância de um mesmo centro?</p>
<figure class="img"><img src="img/circunferencia_3.png" alt="Circunferencia"></figure>
<p>Exatamente — um círculo!</p>
</details>
</blockquote>
<hr>
<h2>O Evento de Círculo</h2>
<p>Esse instante especial recebe o nome de evento de círculo (circle event) no algoritmo de Fortune.</p>
<p>Ele marca o momento exato em que uma das parábolas da beachline desaparece —
ou, como se diz, morre.
No mesmo instante, o algoritmo registra o ponto onde isso acontece:
o vértice de Voronoi, o local onde as três células se encontram.</p>
<blockquote class="question">
<p>Pergunta</p>
<p>Tente visualizar:
à medida que a sweeping line continua descendo, esse vértice recém-criado fica para trás, como uma marca gravada no mapa.</p>
<p>Enquanto isso, a beachline segue viva — mudando de forma e criando novos vértices conforme mais eventos acontecem.</p>
<details class="answer">
<summary>Resposta</summary>
<p>Acesse o <a href="https://www.geogebra.org/calculator/z9zcsu6s" target="_blank">arquivo do Geogebra</a> para visualizar o Evento de Círculo.</p>
</details>
</blockquote>
<hr>
<h2>Resumindo o Processo</h2>
<ul>
<li>Cada ponto gera uma parábola conforme a sweeping line desce.</li>
<li>As interseções dessas parábolas formam as arestas do diagrama.</li>
<li>Quando três parábolas se encontram e formam uma circunferência tangente à sweeping line:</li>
<li>O ponto mais distante é “engolido” → evento de círculo;</li>
<li>O cruzamento das três parábolas é salvo → novo vértice de Voronoi.</li>
<li>A beachline continua viva, atualizando-se a cada novo ponto ou evento.</li>
</ul>
<hr>
<h2>Complexidade</h2>
<p>Partindo para o tema de complexidade, vamos começar pensando sobre o numero de pontos de interesse e como ele vai impactar a complexidade</p>
<blockquote class="question">
<p>Pergunta</p>
<p>Imagine que estamos criando um diagrama de voronoi com 5 pontos de interesse. Conforme a sweeping line desce, ela vai encontrando eventos.
Quantos eventos principais você acha que teremos nesse caso?</p>
<details class="answer">
<summary>Resposta</summary>
<p>Teremos 1 para cada ponto, entao 5 eventos principais.</p>
</details>
</blockquote>
<blockquote class="question">
<p>Pergunta</p>
<p>E se tivessemos 10 pontos de interesse? E 20?</p>
<details class="answer">
<summary>Resposta</summary>
<p>Você deve ter percebido que a quantidade de eventos principais é proporcional ao número de pontos de interesse.
Cada ponto gera um novo evento — o algoritmo precisa lidar com todos eles, um por um.
Isso já nos dá uma boa pista sobre a complexidade do algoritmo.</p>
</details>
</blockquote>
<p>Mas sera que o algoritmo precisa se preocupar com todos os pontos a todo momento? A resposta e não! Essa e a grande diferenca do algoritmo de Fortune para os outros, ele so tem que se preocupar com os pontos vizinhos, então os pontos relativamente proximos da sweeping line</p>
<blockquote class="question">
<p>Pergunta</p>
<p>Pensando então que o algoritmo so precisa se preocupar com os pontos vizinhos, o que podemos concluir sobre a complexidade do algoritmo?</p>
<p>Dica 1: Pode ajudar pensar em um algoritmo com 3 pontos e comparar com um algoritmo com 1000. Sera que ele faz o mesmo numero de contas novas para cada ponto de interesse novo que aparece? Ou sera que não esta tudo mais pronto e determinado ja?</p>
<p>Dica 2: Como concluimos anteriormente, a complexidade e parcialmente linear, então sabemos que é O (n * algo)</p>
<details class="answer">
<summary>Resposta</summary>
<p>A complexidade e O(n logn).</p>
<p>Podemos concluir isso pensando que, além de lidar com cada ponto uma vez (por isso o n), o algoritmo também precisa manter os eventos em ordem conforme a sweeping line desce.</p>
<p>Mas o que significa “manter em ordem”?</p>
<p>Significa que, a cada novo ponto ou evento de círculo, o algoritmo atualiza sua lista de eventos — inserindo ou removendo itens de forma organizada.
Essas pequenas atualizações explicam o log n na complexidade.</p>
</details>
</blockquote>
<p>Outros algoritmos para gerar diagramas de Voronoi são menos eficientes que o de Fortune.
Um exemplo é o método direto por distância, que compara cada ponto do plano com todos os sítios e tem complexidade O(n²). Outro é o método incremental, que adiciona os pontos um a um e atualiza o diagrama a cada inserção, também com custo próximo de O(n²).
Por isso, o algoritmo de Fortune se destaca como o mais rápido entre eles, com complexidade O(n log n).</p>


        </main>
        <footer>
            <a href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank">
                <img alt="CC BY-SA 4.0" src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png" title="Creative Commons Attribution-ShareAlike 4.0 International License" />
            </a>
            © 2024 Marcelo Hashimoto
        </footer>
    </div>
</body>

</html>