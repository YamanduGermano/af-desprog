<!DOCTYPE html>
<html lang="pt-br">

<head>
    <title>Algoritmo de Fortune para Diagrama de Voronoi</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,700;1,400;1,700&family=Open+Sans+Condensed:ital,wght@0,300;1,300&family=Open+Sans:ital,wght@0,300;0,400;0,700;0,800;1,300;1,400;1,700;1,800&family=Oxygen+Mono&family=Josefin+Sans:ital,wght@0,200;0,600;1,200;1,600&display=swap">
    <link rel="stylesheet" href="assets/css/reset.css">
    <link rel="stylesheet" href="assets/css/highlight.css">
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/css/color.css">
    <!--<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>-->
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script async src="https://static.codepen.io/assets/embed/ei.js"></script>
    <script src="assets/js/highlight.js"></script>
    <script src="assets/js/script.js"></script>
</head>

<body>
    <div class="container">
        <header>
            <a href="">abrir tudo</a>
            <a href="">fechar tudo</a>
        </header>
        <main>

            <h1>Algoritmo de Fortune para Diagrama de Voronoi</h1>
<h2>Como se encontrar pela floresta</h2>
<h2>Motivação</h2>
<p>Imagine que você é um pássaro!
Você está voando o dia todo e não conseguiu beber nenhum gole de água. Por sorte, você sabe que ao seu redor, num raio de poucos quilômetros, existem algumas fontes de água. Aqui está o mapa da floresta:</p>
<figure class="img"><img src="img/mapa1.jpg" alt="Mapa da floresta"></figure>
<p>Cada caixinha azul é um ponto de água diferente.</p>
<blockquote class="warning">
<p>Aviso</p>
<p>Como sabemos qual ponto de água mais próximo de você?</p>
</blockquote>
<h2>Métodos de localização:</h2>
<h2>Método das distâncias</h2>
<p>Você sabe sua posição e a posição das fontes de água ao seu redor pois você é um pássaro e seu senso de localização é ótimo! (quase um GPS biológico).</p>
<figure class="img"><img src="img/mapa2.jpg" alt="Mapa da florestacom coordenadas"></figure>
<p>É possível calcular todas as distâncias entre os você e cada um dos pontos utilizando o teorema de pitágoras.</p>
<blockquote class="question">
<p>Pergunta</p>
<p>Tente encontrar o menor valor entre eles:</p>
<details class="answer">
<summary>Resposta</summary>
<p>O arquivo <code class="language-md">dist_m1.py</code> calcula todas essas distâncias e imprime seus valores.</p>
<figure class="table"><table>
<thead>
<tr>
<th>Lugar</th>
<th>Distância</th>
</tr>
</thead>
<tbody>
<tr>
<td>Queda d’água</td>
<td>1.12 km</td>
</tr>
<tr>
<td>Riacho</td>
<td>2.92 km</td>
</tr>
<tr>
<td>Pedra do sapo</td>
<td>1.80 km</td>
</tr>
<tr>
<td>Córrego azul</td>
<td>2.24 km</td>
</tr>
<tr>
<td>Rio Branco</td>
<td>2.24 km</td>
</tr>
<tr>
<td>Pedra molhada</td>
<td>2.12 km</td>
</tr>
<tr>
<td>Lagoa doce</td>
<td>2.55 km</td>
</tr>
</tbody>
</table></figure>
<p>O ponto d’água mais próximo seria a <strong>Queda d’água</strong> com <strong>1.12km</strong> de distância</p>
</details>
</blockquote>
<p>É notável que essa tarefa não é muito eficiente. E, se saíssemos da mesma posição, precisaríamos calcular todas as distâncias novamente.</p>
<p>E se existisse um mapa que indique, para qualquer posição, qual a fonte d’água mais próxima?</p>
<h2>Subdivisão por células</h2>
<figure class="img"><img src="img/mapa4.jpg" alt="Duas fontes de água no mapa"></figure>
<p>Como podemos dividir esse espaço de modo a indicar, para qualquer ponto no mapa, qual a fonte mais próxima?</p>
<blockquote class="question">
<p>Pergunta</p>
<p>Pegue um papel e uma caneta e tente desenhar esse diagrama!</p>
<details class="answer">
<summary>Resposta</summary>
<p>Vamos traçar uma aresta que passa entre ambas as fontes e pintar de azul todos os pontos em que estão à esquerda dela e de verde aqueles que estão a sua direita:</p>
<figure class="img"><img src="img/mapa5.jpg" alt="Duas fontes de água no mapa"></figure>
<p>Agora, sabemos que, se você estiver em qualquer ponto azul, o ponto mais próximo é a <code class="language-Fonte">A</code>. Se você estiver em qualquer ponto verde, porém, o ponto mais próximo é a <code class="language-Fonte">B</code>.</p>
</details>
<p>Agora vamos tentar com três pontos:</p>
<figure class="img"><img src="img/mapa6.jpg" alt="Três fontes de água no mapa"></figure>

</blockquote>
<blockquote class="question">
<p>Pergunta</p>
<p>Pegue um papel e uma caneta e tente desenhar esse diagrama!</p>
<details class="answer">
<summary>Resposta</summary>
<p>Se traçarmos uma reta que divide cada um dos pontos d’água entre si, podemos criar três arestas que subdividem o espaço em três células distintas.</p>
<!-- Se ligarmos uma reta ligando dois pontos quaisquer e traçarmos outra reta perpendicular a ela que cruza o seu centro, conseguimos subdividir o espaço com três arestas. -->
<figure class="img"><img src="img/mapa7.jpg" alt="Duas fontes de água no mapa"></figure>
<p><strong>Observe atentamente esse diagrama e preste atenção nos detalhes:</strong></p>
<ul>
<li>
<p>O cruzamento de todos os segmentos de reta é no <strong>baricentro</strong> do triangulo formado pelas ligações entre os pontos.</p>
</li>
<li>
<p>O ângulo entre cada uma das arestas e as retas que ligam 2 pontos é de 90º.</p>
</li>
<li>
<p>Uma aresta sempre <strong>divide ao meio</strong> uma reta que liga dois pontos.</p>
</li>
</ul>
<p>Assim, é muito mais fácil ver qual o ponto d’água mais próximo para qualquer ponto do mapa!</p>
</details>
</blockquote>
<h2>Diagrama de Voronoi:</h2>
<p>Dividindo pontos com arestas dessa maneira, podemos criar um mapa que nos conta exatamente qual o ponto mais próximo! Esse é o princípio do <strong>Diagrama de Voronoi</strong>.</p>
<figure class="img"><img src="img/Coloured_Voronoi_2D.png" alt="Diagrama de Voronoi"></figure>
<p>Source: <a href="https://pt.wikipedia.org/wiki/Diagrama_de_Voronoy" target="_blank">Wikipédia</a></p>
<h2>O algoritmo de Fortune</h2>
<p>Uma das formas mais eficientes de gerar diagramas de Voronoi é com o algoritmo de Fortune. Para entender seu funcionamento, vamos partir de uma ideia diferente — mas calma, no fim tudo fará sentido.</p>
<p>Vamos começar com o exemplo abaixo:</p>
<blockquote class="question">
<p>Pergunta</p>
<p>Pegue um papel e caneta e desenhe um ponto pequeno (chamaremos de ponto1), com uma linha horizontal poucos centimetros abaixo e desenhe 5 pontos sobre essa linha (Facilita se voce colocar o ponto do meio exatamente embaixo do ponto1). Agora tente encontrar os pontos de equidistancia entre o ponto original e os pontos sobre a linha.</p>
<p>Vai ficar algo parecido com isso:</p>
<figure class="img"><img src="img/mapa8tr.jpg" alt="Ponto e Pontos na linha"></figure>
<p>Agora, tente encontrar os pontos equidistantes entre os pontos da linha e o ponto 1</p>
<details class="answer">
<summary>Resposta</summary>
<p>Seu diagrama deve ficar algo parecido com:</p>
<figure class="img"><img src="img/mapa9tr.jpg" alt="Pontos de equidistancia"></figure>
</details>
</blockquote>
<blockquote class="question">
<p>Pergunta</p>
<p>Você consegue perceber alguma relação entre esses pontos? Que formato esse padrão formaria?</p>
<details class="answer">
<summary>Resposta</summary>
<p>Voce deve ter concluido que os pontos de equidistancia formam uma parabola</p>
<figure class="img"><img src="img/mapa10tr.jpg" alt="Parabola"></figure>
</details>
</blockquote>
<p>Agora partimos para um segundo instante. Vamos imaginar que a sweeping line desceu um pouco, para um pouco mais longe do nosso ponto 1.</p>
<blockquote class="question">
<p>Pergunta</p>
<p>Tente pensar no que vai acontecer com os pontos e então com a parabola.</p>
<p>Sera que ela vai abrir/fechar mais? Sera que vai permanecer igual?</p>
<p>Se nao estiver conseguindo visualizar, use o papel e compare as respostas. Para que a diferença fique mais clara, faca uma sweeping line bem mais longe do ponto.</p>
<details class="answer">
<summary>Resposta</summary>
<p>A parabola vai abrir cada vez mais quando a sweeping line desce.</p>
<figure class="img"><img src="img/mapa11tr.jpg" alt="Parabola aberta"></figure>
</details>
</blockquote>
<p>Caso tenha restado alguma duvida, desenvolvemos um arquivo no geogebra que facilita muito o entendimento:</p>
<div style="position:relative; width:fit">
<iframe src="https://www.geogebra.org/calculator/xztbxdvv?embed" allowfullscreen="" style="border: 1px solid #e4e4e4;border-radius: 4px; width:100%; height:70vh" frameborder="0"></iframe>
</div>
<p>Agora nos deduzimos tudo o que deveriamos para um ponto so, e esta na hora de acrescentar um segundo ponto, ai mais pra frente um terceiro.</p>
<hr>
<p>Vamos começar evoluindo a atividade que fizemos para um ponto, agora usando 2. Cada um vai formar a sua parabola, que vai seguir o mesmo padrão da atividade que fizemos com um ponto so. Mas agora vamos pensar no seguinte:</p>
<blockquote class="question">
<p>Pergunta</p>
<p>O que significa a interseção entre duas parabolas (o ponto vermelho)? Pense no que falamos sobre a função da parabola.</p>
<figure class="img"><img src="img/int_2pontos.png" alt="Interseção 2 pontos"></figure>
<details class="answer">
<summary>Resposta</summary>
<p>A interseção entre duas parabolas representa um ponto de equidistancia entre as duas parabolas e a sweeping line</p>
</details>
</blockquote>
<blockquote class="question">
<p>Pergunta</p>
<p>Sabendo disso, imagine a sweeping line descendo em relação a sua posição anterior. Imagine o que pode estar acontecendo com os pontos de interseção.</p>
<p>Desenvolvemos um arquivo no GeoGebra que vai ajudar bastante a tirar essa conclusão. Tente encontrar o tipo de relação entre os pontos de interseção com a sweeping line variando.</p>
<div style="position:relative; width:fit">
<iframe src="https://www.geogebra.org/calculator/vkarzdzv?embed" allowfullscreen="" style="border: 1px solid #e4e4e4;border-radius: 4px; width:100%; height:70vh" frameborder="0"></iframe>
</div>
<details class="answer">
<summary>Resposta</summary>
<p>Para obter a resposta, ativar o trace do ponto de interseção.</p>
<p>Voce deve ter concluido que os pontos tem uma relação linear uns com os outros. Essa linha que esta sendo formada e justamente uma das arestas do diagrama de Voronoi.
Então conforme a sweeping line desce, o algoritmo esta traçando a aresta que divide os dois pontos no diagrama</p>
</details>
</blockquote>
<blockquote class="question">
<p>Pergunta</p>
<p>Então sabendo isso e o que falamos anteriormente sobre o diagrama de Voronoi, o que conseguimos deduzir sobre pontos que estão de um lado da linha e do outro? O que todos tem em comum com quais respectivos pontos de interesse?</p>
<p>Dica: Pense na distancia</p>
<details class="answer">
<summary>Resposta</summary>
<p>Conseguimos concluir que pontos de cada lado da linha estao mais proximos do ponto de interesse que esta do mesmo lado</p>
</details>
</blockquote>
<p>Parabens, voce acabou de entender a logica por traz de um algoritmo de Fortune para 2 pontos em um grafico!</p>
<hr>
<p>Antes de adicionar-mos um ponto, vamos entender o conceito da beachline.</p>
<p>Como no início do handout, pense nos pontos equidistantes entre um ponto e a sweeping line — eles formam uma parábola. Pensou? Agora imagine duas dessas parábolas. A beachline é formada pelos pontos que estão ao mesmo tempo nas duas parábolas e que estão mais próximos da sweeping line em cada posição no eixo x.</p>
<p>Aqui esta uma imagem que nos ajuda a visualizar isso.</p>
<p>Agora que entendemos o conceito, vamos adicionar um terceiro ponto. A lógica é a mesma para 4, 5 ou mais pontos, então, ao compreendermos o caso com 3, poderemos generalizar para qualquer quantidade.</p>
<p>Voltando a pensar nas parabolas criadas e nossa sweeping line, quais sao os pontos de equidistancia entre qualquer um dos pontos e a sweeping line? Perceba que esses pontos vao formar uma linha, e chamaremos essa linha de beachline
Dica: Pense nas parabolas e seus pontos de interseçoes.</p>
<p>Abaixo esta um arquivo no GeoGebra que facilita essa visualização e entendimento.</p>
<div style="position:relative; width:fit">
<iframe src="https://www.geogebra.org/calculator/nghuzruv?embed" allowfullscreen="" style="border: 1px solid #e4e4e4;border-radius: 4px; width:100%; height:70vh" frameborder="0"></iframe>
</div>
<hr>
<h2>Três Pontos e o Nascimento da Beachline</h2>
<p>Agora que você já entendeu a lógica para um ponto e para dois pontos, chegou a hora de adicionar o terceiro.</p>
<p>Prepare o papel e a caneta: desenhe três pontos não alinhados — algo como um triângulo.
Assim como no caso de dois pontos, quando a sweeping line (linha de varredura) começa acima dos três pontos e desce lentamente, cada um dos pontos gera a sua própria parábola.</p>
<blockquote class="question">
<p>Pergunta</p>
<p>Desenhe as parábolas para cada ponto, com a sweeping line abaixo dos três.
O que podemos observar?</p>
<details class="answer">
<summary>Resposta</summary>
<div style="position:relative; width:fit"> 
<iframe src="https://www.geogebra.org/calculator/nghuzruv?embed" allowfullscreen="" style="border: 1px solid #e4e4e4;border-radius: 4px; width:100%; height:70vh" frameborder="0"></iframe> 
</div>
<p>Movimente o slider “sweep” e observe o comportamento das parábolas. Você deve ter notado que as parábolas se encontram em dois pontos de interseção.
Esses pontos são especiais — e vão nos levar à essência do algoritmo de Fortune.</p>
</details>
</blockquote>
<h2>O Segredo das Interseções</h2>
<blockquote class="question">
<p>Pergunta</p>
<p>Se um ponto está na interseção de duas parábolas, o que isso significa sobre as distâncias?</p>
<details class="answer">
<summary>Resposta</summary>
<p>Esse ponto está equidistante de três elementos:</p>
<ul>
<li>do Ponto 1,</li>
<li>do Ponto 2,</li>
<li>da sweeping line.</li>
</ul>
</details>
</blockquote>
<p>Agora imagine que continuamos descendo a sweeping line.
Em um instante preciso, as três parábolas se encontram em um mesmo ponto.
Quando isso acontece, esse ponto é equidistante:</p>
<ul>
<li>do Ponto 1</li>
<li>do Ponto 2</li>
<li>do Ponto 3</li>
<li>da sweeping line</li>
</ul>
<h2>A “Parábola Engolida”</h2>
<p>Enquanto a sweeping line desce, cada ponto mantém sua própria parábola viva na beachline —
a curva que representa todos os pontos que estão à mesma distância de algum dos focos e da sweeping line.</p>
<p>Mas, quando a linha chega à altura da tangente inferior da circunferência que passa pelos três pontos, algo curioso acontece:</p>
<p>A parábola do ponto mais distante (o que está no topo da circunferência) é engolida pelas outras duas.
Ou seja, ela deixa de fazer parte da beachline.</p>
<blockquote class="question">
<p>Pergunta</p>
<p>O que isso significa?</p>
<details class="answer">
<summary>Resposta</summary>
<p>Significa que, naquele instante, surge um novo vértice no diagrama de Voronoi —
o ponto onde as três células se encontram!</p>
</details>
</blockquote>
<h2>O Evento de Círculo</h2>
<p>Esse momento é chamado de evento de círculo (circle event) no algoritmo de Fortune.</p>
<p>Ele marca o instante em que uma das parábolas da beachline desaparece — ou “morre”.
E, exatamente nesse momento, o algoritmo cria um vértice de Voronoi no ponto de interseção das três arestas correspondentes.</p>
<blockquote class="question">
<p>Pergunta</p>
<p>Tente visualizar: se a sweeping line continuar descendo, o vértice recém-criado fica para trás, congelado no mapa,
enquanto a beachline continua se deformando abaixo.</p>
<details class="answer">
<summary>Resposta</summary>
<div style="position:relative; width:fit"> 
<iframe src="https://www.geogebra.org/calculator/z9zcsu6s" allowfullscreen="" style="border: 1px solid #e4e4e4;border-radius: 4px; width:100%; height:70vh" frameborder="0"></iframe> 
</div>
</details>
</blockquote>
<h2>Resumindo o Processo</h2>
<ul>
<li>Cada ponto gera uma parábola conforme a sweeping line desce.</li>
<li>As interseções dessas parábolas formam as arestas do diagrama.</li>
<li>Quando três parábolas se encontram e formam uma circunferência tangente à sweeping line:</li>
<li>O ponto mais distante é “engolido” → evento de círculo;</li>
<li>O cruzamento das três parábolas é salvo → novo vértice de Voronoi.</li>
<li>A beachline continua viva, atualizando-se a cada novo ponto ou evento.</li>
</ul>
<hr>
<h2>Complexidade</h2>
<p>Partindo para o tema de complexidade, vamos começar pensando sobre o numero de pontos de interesse e como ele vai impactar a complexidade</p>
<blockquote class="question">
<p>Pergunta</p>
<p>Imagine que estamos criando um diagrama de voronoi com 5 pontos de interesse. Conforme a sweeping line desce, ela vai encontrando eventos.
Quantos eventos principais você acha que teremos nesse caso?</p>
<details class="answer">
<summary>Resposta</summary>
<p>Teremos 1 para cada ponto, entao 5 eventos principais.</p>
</details>
</blockquote>
<blockquote class="question">
<p>Pergunta</p>
<p>E se tivessemos 10 pontos de interesse? E 20?</p>
<details class="answer">
<summary>Resposta</summary>
<p>Você deve ter percebido que a quantidade de eventos principais é proporcional ao número de pontos de interesse.
Cada ponto gera um novo evento — o algoritmo precisa lidar com todos eles, um por um.
Isso já nos dá uma boa pista sobre a complexidade do algoritmo.</p>
</details>
</blockquote>
<p>Mas sera que o algoritmo precisa se preocupar com todos os pontos a todo momento? A resposta e não! Essa e a grande diferenca do algoritmo de Fortune para os outros, ele so tem que se preocupar com os pontos vizinhos, então os pontos relativamente proximos da sweeping line</p>
<blockquote class="question">
<p>Pergunta</p>
<p>Pensando então que o algoritmo so precisa se preocupar com os pontos vizinhos, o que podemos concluir sobre a complexidade do algoritmo?</p>
<p>Dica 1: Pode ajudar pensar em um algoritmo com 3 pontos e comparar com um algoritmo com 1000. Sera que ele faz o mesmo numero de contas novas para cada ponto de interesse novo que aparece? Ou sera que não esta tudo mais pronto e determinado ja?</p>
<p>Dica 2: Como concluimos anteriormente, a complexidade e parcialmente linear, então sabemos que é O (n * algo)</p>
<details class="answer">
<summary>Resposta</summary>
<p>A complexidade e O(n logn).</p>
<p>Podemos concluir isso pensando que, além de lidar com cada ponto uma vez (por isso o n), o algoritmo também precisa manter os eventos em ordem conforme a sweeping line desce.</p>
<p>Mas o que significa “manter em ordem”?</p>
<p>Significa que, a cada novo ponto ou evento de círculo, o algoritmo atualiza sua lista de eventos — inserindo ou removendo itens de forma organizada.
Essas pequenas atualizações explicam o log n na complexidade.</p>
</details>
</blockquote>
<p>Outros algoritmos para gerar diagramas de Voronoi são menos eficientes que o de Fortune.
Um exemplo é o método direto por distância, que compara cada ponto do plano com todos os sítios e tem complexidade O(n²). Outro é o método incremental, que adiciona os pontos um a um e atualiza o diagrama a cada inserção, também com custo próximo de O(n²).
Por isso, o algoritmo de Fortune se destaca como o mais rápido entre eles, com complexidade O(n log n).</p>


        </main>
        <footer>
            <a href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank">
                <img alt="CC BY-SA 4.0" src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png" title="Creative Commons Attribution-ShareAlike 4.0 International License" />
            </a>
            © 2024 Marcelo Hashimoto
        </footer>
    </div>
</body>

</html>